;Collin Caram
;chc829

(!! copy
   '(

(align 4)
        ; Source block
        (pos 14608)
        src
    (dword 1)
        (dword 2)
        (dword 3)
        (dword 4)
        (dword 5)
        (dword 6)
        (dword 7)
        (dword 8)
        (dword 9)
        (dword 10)
        (dword 11)
        (dword 12)
        (dword 13)
        (dword 14)
        (dword 15)
        (dword 16)
        (dword 17)
        (dword 18)
        (dword 19)
        (dword 20)
        (dword 21)
        (dword 22)
        (dword 23)
        (dword 24)
        (dword 25)
        (dword 26)
        (dword 27)
        (dword 28)
        (dword 29)
        (dword 30)
        (dword 31)
        (dword 32)
        (dword 33)
        (dword 34)
        (dword 35)
        (dword 36)
        (dword 37)
        (dword 38)
        (dword 39)
        (dword 40)
        (dword 41)
        (dword 42)
        (dword 43)
        (dword 44)
        (dword 45)
        (dword 46)
        (dword 47)
        (dword 48)
        (dword 49)
        (dword 50)
        (dword 51)
        (dword 52)
        (dword 53)
        (dword 54)
        (dword 55)
        (dword 56)
        (dword 57)
        (dword 58)
        (dword 59)
        (dword 60)
        (dword 61)
        (dword 62)
        (dword 63)
        (dword 64)
        (dword 65)
        (dword 66)
        (dword 67)
        (dword 68)
        (dword 69)
        (dword 70)
        (dword 71)
        (dword 72)
        (dword 73)
        (dword 74)
        (dword 75)
        (dword 76)
        (dword 77)
        (dword 78)
        (dword 79)
        (dword 80)
        (dword 81)
        (dword 82)
        (dword 83)
        (dword 84)
        (dword 85)
        (dword 86)
        (dword 87)
        (dword 88)
        (dword 89)
        (dword 90)
        (dword 91)
        (dword 92)
        (dword 93)
        (dword 94)
        (dword 95)
        (dword 96)
        (dword 97)
        (dword 98)
        (dword 99)
        (dword 100)
        (dword 101)
        (dword 102)
        (dword 103)
        (dword 104)
        (dword 105)
        (dword 106)
        (dword 107)
        (dword 108)
        (dword 109)
        (dword 110)
        (dword 111)
        (dword 112)
        (dword 113)
        (dword 114)
        (dword 115)
        (dword 116)
        (dword 117)
        (dword 118)
        (dword 119)
        (dword 120)
        (dword 121)
        (dword 122)
        (dword 123)
        (dword 124)
        (dword 125)
        (dword 126)
        (dword 127)
        (dword 128)
        (dword 129)
        (dword 130)
        (dword 131)
        (dword 132)
        (dword 133)
        (dword 134)
        (dword 135)
        (dword 136)
        (dword 137)
        (dword 138)
        (dword 139)
        (dword 140)
        (dword 141)
        (dword 142)
        (dword 143)
        (dword 144)
        (dword 145)
        (dword 146)
        (dword 147)
        (dword 148)
        (dword 149)
        (dword 150)
        (dword 151)
        (dword 152)
        (dword 153)
        (dword 154)
        (dword 155)
        (dword 156)
        (dword 157)
        (dword 158)
        (dword 159)
        (dword 160)
        (dword 161)
        (dword 162)
        (dword 163)
        (dword 164)
        (dword 165)
        (dword 166)
        (dword 167)
        (dword 168)
        (dword 169)
        (dword 170)
        (dword 171)
        (dword 172)
        (dword 173)
        (dword 174)
        (dword 175)
        (dword 176)
        (dword 177)
        (dword 178)
        (dword 179)
        (dword 180)
        (dword 181)
        (dword 182)
        (dword 183)
        (dword 184)
        (dword 185)
        (dword 186)
        (dword 187)
        (dword 188)
        (dword 189)
        (dword 190)
        (dword 191)
        (dword 192)
        (dword 193)
        (dword 194)
        (dword 195)
        (dword 196)
        (dword 197)
        (dword 198)
        (dword 199)
        (dword 200)
        (dword 201)
        (dword 202)
        (dword 203)
        (dword 204)
        (dword 205)
        (dword 206)
        (dword 207)
        (dword 208)
        (dword 209)
        (dword 210)
        (dword 211)
        (dword 212)
        (dword 213)
        (dword 214)
        (dword 215)
        (dword 216)
        (dword 217)
        (dword 218)
        (dword 219)
        (dword 220)
        (dword 221)
        (dword 222)
        (dword 223)
        (dword 224)
        (dword 225)
        (dword 226)
        (dword 227)
        (dword 228)
        (dword 229)
        (dword 230)
        (dword 231)
        (dword 232)
        (dword 233)
        (dword 234)
        (dword 235)
        (dword 236)
        (dword 237)
        (dword 238)
        (dword 239)
        (dword 240)
        (dword 241)
        (dword 242)
        (dword 243)
        (dword 244)
        (dword 245)
        (dword 246)
        (dword 247)
        (dword 248)
        (dword 249)
        (dword 250)
        (dword 251)
        (dword 252)
        (dword 253)
        (dword 254)
        (dword 255)
        (dword 0)

     ; Destination block
        (pos 17024)
        dest
    (dword 222)
    (dword 3)
    (dword 6)
    (dword 9)
    (dword 12)
    (dword 15)
    (dword 18)
    (dword 21)
    (dword 24)
    (dword 27)
    (dword 30)
    (dword 33)
    (dword 36)
    (dword 39)
    (dword 42)
    (dword 45)
    (dword 48)
    (dword 51)
    (dword 54)
    (dword 57)
    (dword 60)
    (dword 63)
    (dword 66)
    (dword 69)
    (dword 72)
    (dword 75)
    (dword 78)
    (dword 81)
    (dword 84)
    (dword 87)
    (dword 90)
    (dword 93)
    (dword 96)
    (dword 99)
    (dword 102)
    (dword 105)
    (dword 108)
    (dword 111)
    (dword 114)
    (dword 117)
    (dword 120)
    (dword 123)
    (dword 126)
    (dword 129)
    (dword 132)
    (dword 135)
    (dword 138)
    (dword 141)
    (dword 144)
    (dword 147)
    (dword 150)
    (dword 153)
    (dword 156)
    (dword 159)
    (dword 162)
    (dword 165)
    (dword 168)
    (dword 171)
    (dword 174)
    (dword 177)
    (dword 180)
    (dword 183)
    (dword 186)
    (dword 189)
    (dword 192)
    (dword 195)
    (dword 198)
    (dword 201)
    (dword 204)
    (dword 207)
    (dword 210)
    (dword 213)
    (dword 216)
    (dword 219)
    (dword 222)
    (dword 225)
    (dword 228)
    (dword 231)
    (dword 234)
    (dword 237)
    (dword 240)
    (dword 243)
    (dword 246)
    (dword 249)
    (dword 252)
    (dword 255)
    (dword 258)
    (dword 261)
    (dword 264)
    (dword 267)
    (dword 270)
    (dword 273)
    (dword 276)
    (dword 279)
    (dword 282)
    (dword 285)
    (dword 288)
    (dword 291)
    (dword 294)
    (dword 297)
    (dword 300)
    (dword 303)
    (dword 306)
    (dword 309)
    (dword 312)
    (dword 315)
    (dword 318)
    (dword 321)
    (dword 324)
    (dword 327)
    (dword 330)
    (dword 333)
    (dword 336)
    (dword 339)
    (dword 342)
    (dword 345)
    (dword 348)
    (dword 351)
    (dword 354)
    (dword 357)
    (dword 360)
    (dword 363)
    (dword 366)
    (dword 369)
    (dword 372)
    (dword 375)
    (dword 378)
    (dword 381)
    (dword 384)
    (dword 387)
    (dword 390)
    (dword 393)
    (dword 396)
    (dword 399)
    (dword 402)
    (dword 405)
    (dword 408)
    (dword 411)
    (dword 414)
    (dword 417)
    (dword 420)
    (dword 423)
    (dword 426)
    (dword 429)
    (dword 432)
    (dword 435)
    (dword 438)
    (dword 441)
    (dword 444)
    (dword 447)
    (dword 450)
    (dword 453)
    (dword 456)
    (dword 459)
    (dword 462)
    (dword 465)
    (dword 468)
    (dword 471)
    (dword 474)
    (dword 477)
    (dword 480)
    (dword 483)
    (dword 486)
    (dword 489)
    (dword 492)
    (dword 495)
    (dword 498)
    (dword 501)
    (dword 504)
    (dword 507)
    (dword 510)
    (dword 513)
    (dword 516)
    (dword 519)
    (dword 522)
    (dword 525)
    (dword 528)
    (dword 531)
    (dword 534)
    (dword 537)
    (dword 540)
    (dword 543)
    (dword 546)
    (dword 549)
    (dword 552)
    (dword 555)
    (dword 558)
    (dword 561)
    (dword 564)
    (dword 567)
    (dword 570)
    (dword 573)
    (dword 576)
    (dword 579)
    (dword 582)
    (dword 585)
    (dword 588)
    (dword 591)
    (dword 594)
    (dword 597)
    (dword 600)
    (dword 603)
    (dword 606)
    (dword 609)
    (dword 612)
    (dword 615)
    (dword 618)
    (dword 621)
    (dword 624)
    (dword 627)
    (dword 630)
    (dword 633)
    (dword 636)
    (dword 639)
    (dword 642)
    (dword 645)
    (dword 648)
    (dword 651)
    (dword 654)
    (dword 657)
    (dword 660)
    (dword 663)
    (dword 666)
    (dword 669)
    (dword 672)
    (dword 675)
    (dword 678)
    (dword 681)
    (dword 684)
    (dword 687)
    (dword 690)
    (dword 693)
    (dword 696)
    (dword 699)
    (dword 702)
    (dword 705)
    (dword 708)
    (dword 711)
    (dword 714)
    (dword 717)
    (dword 720)
    (dword 723)
    (dword 726)
    (dword 729)
    (dword 732)
    (dword 735)
    (dword 738)
    (dword 741)
    (dword 744)
    (dword 747)
    (dword 750)
    (dword 753)
    (dword 756)
    (dword 759)
    (dword 762)
    (dword 765)
        end

   main
     (irmovl stack_top %esp)
     (irmovl stack_top %ebp) 
     (irmovl 256 %edx)           ; %edx <-- 8 -- This is int len 
     (pushl %edx)
     (irmovl 10500 %edx)         ; %edx <-- this is int *dest (12)
     (pushl %edx)
     (irmovl 9000  %edx)         ; %edx <-- this is int *src (8)
     (pushl %edx)
     (call ocopy_block)
     (popl %edx)                 ; pop parameters off stack 
     (popl %edx)
     (popl %edx)
     (halt)
   
    ocopy_block
    (pushl %ebp)
    (rrmovl %esp %ebp)
    (pushl %edi)
    (xorl %eax %eax)
    (pushl %esi)
    (pushl %ebx)
    (mrmovl 8  (%ebp) %ecx) ;src
    (mrmovl 12 (%ebp) %edx) ;dest
    (mrmovl 16 (%ebp) %ebx) ;len
    (andl %ebx %ebx)
    (jle L3)


    L4
    (mrmovl 0 (%ecx) %edi)
    (iaddl 4294967292 %ebx)
    (rmmovl %edi 0 (%edx))
    (mrmovl 4 (%ecx) %esi)
    (rmmovl %esi 4 (%edx))
    (xorl %edi %esi)
    (xorl %esi %eax)
    (mrmovl 8 (%ecx) %esi)
    (xorl %esi %eax)
    (rmmovl %esi 8 (%edx))
    (mrmovl 12 (%ecx) %esi)
    (iaddl 16 %ecx)
    (rmmovl %esi 12 (%edx))
    (xorl %esi %eax)
    (iaddl 16 %edx)
    (andl %ebx %ebx)
    (jg L4)

    L3
    (popl %ebx)
    (popl %esi)
    (popl %edi)
    (rrmovl %ebp %esp)
    (popl %ebp)
    (ret)

 
     ;; Stack
     (pos 8192)
   stack_top
     ))
;-------------------------------> Y86 LISP CODE <-------------------------------
;-------------------------------> SYNTAX CHECKER <------------------------------
(y86-prog (@ copy))
;-------------------------------> SYNTAX CHECKER <------------------------------    
;--------------------------------> SYMBOL TABLE <-------------------------------
(! location 0)
(! symbol-table
   (hons-shrink-alist
    (y86-symbol-table (@ copy) (@ location) 'symbol-table)
    'shrunk-symbol-table))
;--------------------------------> SYMBOL TABLE <-------------------------------
;--------------------------------> PROGRAM IMAGE <------------------------------
(!! init-mem
    (hons-shrink-alist
     (y86-asm (@ copy) (@ location) (@ symbol-table) 'copyprog)
     'copyprog-iterative))
;--------------------------------> PROGRAM IMAGE <------------------------------
;-----------------------------> INITIALIZE MACHINE <----------------------------
(m86-clear-regs x86-32)       ; Clear registers
(m86-clear-mem  x86-32 9500)  ; Clear memory location 0 to 9500

(! init-pc (cdr (hons-get 'main (@ symbol-table))))
(! y86-status nil)   ; Initial value for the Y86 status register

(init-y86-state
 (@ y86-status)  ; Y86 status
 (@ init-pc)     ; Initial program counter
 nil             ; Initial registers, if NIL, then all zeros
 nil             ; Initial flags, if NIL, then all zeros
 (@ init-mem)    ; Initial memory
 x86-32
 )
;-----------------------------> INITIALIZE MACHINE <----------------------------
;-----------------------------> EXECUTION COMMANDS <----------------------------

(time$ (y86 x86-32 1118))
(m32-get-mem-words (cdr (hons-get 'src (@ symbol-table))) 256 x86-32)
(m32-get-mem-words (cdr (hons-get 'dest (@ symbol-table))) 256 x86-32)
(m32-get-regs-and-flags x86-32)